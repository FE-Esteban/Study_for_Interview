# 이벤트 루프
자바스크립트는 싱글 스드 기반 언어이기 때문에, **한번에 하나씩** 작업을 진행한다. 

그러나 자바스크립트가 사용되는 환경을 생각해보면, 많은 작업이 동시에 처리되고 있습니다. 

자바스크립트는 이벤트 루프를 이용해서 비동기 방식으로 동시성을 지원합니다. 

자바스크립트 엔진에서 제공되는 것이 아니고, 브라우저나 node.js에서 지원된다.
node.js는 libuv 라이브러리를 사용하여, 이벤트 루프를 제공한다. 

이벤트 루프에서는 이벤트 발생 시  호출되는 콜백 함수들을 태스크 큐에 전달하고
태스크 큐에 담겨 있는 콜백 함수들을 콜 스택에 넘겨준다.

* 이벤트 루프가 태스크 큐에서 콜 스택으로 콜백 함수를 넘겨주는 작업은 콜스택에 쌓여있는 함수가 없을 때만 수행된다.

* 태스크 큐에서는 web api에서 비동기 작업들이 실행된 후 호출되는 콜백 함수들이 기다리는 공간이다. 


* 태스크 큐는 하나의 큐로 이루어져 있지 않는다. 
* 여러개의 큐로 이루어져 있다.


## 비동기 작업을 수행하는 코드는 아래의 순서로 실행된다.
1. 코드가 호출 스택에 쌓인 후, 실행되면 자바스크립트 엔진은 비동기 작업을 web API에게 위임한다. 
2. web API는 해당 비동기 작업을 수행하고, 콜백 함수를 이벤트 루프를 통해서 대스크 큐에 넘겨주게 된다.
3. 이벤트 루프는 콜스택에 쌓여있는 함수가 없을 떄, 태스크 큐에서 대기하고 있던 콜백 함수를 콜 스택으로 넘겨준다. 
4. 콜스택에 쌓인 콜백함수가 실행되고 콜스택에서 제거된다.


- 이벤트 루프는 콜 스택이 비어있으면 콜백 큐에 있는 첫 번째 콜백을 콜 스택에 보내주는 역할을 합니다.
- 전체적인 동작 과정은 처음 코드가 콜 스택에 들어가는데, 코드가 순차적으로 쌓이게 되고, 후입 선출 방식으로 호출이 됩니다. 
- 자바스크립트 자체에서 실행이 되는 코드는 콜 스택에서 사라지면서 바로 처리가 되고, 
- 브라우저에서 실행이 되는 코드들은 web apis로 빠지면서 콜 스택에서 사라지게 됩니다.
- web apis에 도착한 코드들은 실행이 되고, 콜백들이 콜백 큐에 쌓이게 됩니다.
- 콜 스택에서 코드가 다 제거가 되고나면 콜백 큐에 있던 첫 번째 요소가 빠져나가면서 콜 스택에 들어가게 되고, 콜 스택에서 실행이 됩니다. 콜백 큐가 비어질 때까지 이 과정이 반복이 됩니다.


## 용어 설명

- Heap :  메모리 할당이 발생하는 곳
- Call Stack : 실행된 코드의 환경을 저장하는 자료구조로, 함수 호출 시 이곳에 저장된다. 어떤 함수를 저장하면 스택에 쌓고 또 다른 함수를 호출하면 그 다음 스택에 쌓이면서 가장 위에 쌓인 함수를 가장 먼저 처리한다. (LIFO)

- Web APIs : Web API는 브라우저에서 제공하는 API로 DOM, Ajax, TimeOut등이 있다. CallStack에서 실행된 비동기 함수는 Web API를 호출하고, Web API는 콜백 함수를 Task Queue에 넣는다. 

- Callback Queue : 함수를 저장하는 자료구조로, Call Stack과 다르게 가장 먼저 들어온 함수를 가장 먼저 처리한다. FIFO

- Event Loop : 이벤트 루프는 call stack 이 다 비워지면 callback queue에 존재하는 함수를 하나씩 call stack으로 옮기는 역할을 한다.

